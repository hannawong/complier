#### 名称解析

我们需要给自己的编译器新增一个阶段：名称解析，它位于语法分析和 IR 生成之间。

名称解析广义上的含义就是：把名称关联到对应的实体。

```
{
    int a=0;            // a0
    a=                  // a0
        a+1;            // a0
    if (a) {            // a0
        int a=2;        // a1
        return a;       // a1
    }
    return a;           // a0
    {
        int b=12;       // b0
        return a        // a0
                +b;     // b0
    }
}
```

用于储存变量信息的 **符号表** 的结构也需要改进，以支持作用域。具体的，它需要支持

1. 符号表中，区分不同作用域的变量：支持声明覆盖（shadowing)、检查重复声明
2. 离开某作用域时，要把其中的变量从符号表中删除

为此，我们把符号表改造为一个栈。

1. (对应上面 1.）栈中每个元素都对应一个开作用域，是一个列表，包含该作用域中至今声明过的所有变量。

   > 程序中不同位置的符号表是不同的；某位置的 **开作用域（open scope）** 指的是包含该位置的所有作用域。 例如上图中 `return a+b;` 处，有两个开作用域（声明 a0 和 b0 的），而声明 a1 的作用域不是开作用域。

2. （对应上面 2.) 每进入一个作用域，就压栈一个空列表；离开作用域就弹栈

3. 在符号表中查找变量名，从栈顶往下查找（所以内层声明才能覆盖外层声明）。